<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pending Approvals</title>
    <style>
        body { font-family: sans-serif;
            margin: 0; background-color: #f4f4f9; color: #333; }
        .container { max-width: 1400px; /* Increased width to fit new columns */
            margin: 2em auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 { color: #444;
        }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 0.5em; margin-top: 2em;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5em;
        }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd;
        }
        th { background-color: #6c757d; color: white;
        }
        tr:nth-child(even) { background-color: #f9f9f9;
        }
        
        .no-pending { text-align: center; font-style: italic; color: #666; margin-top: 1em;
        }

        /* --- NEW ACTION BUTTON STYLES --- */
        .btn-action {
            display: inline-block; 
            box-sizing: border-box;
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 4px;
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.85em;
            border: 1px solid transparent;
            cursor: pointer;
            background-color: white;
            transition: all 0.2s;
            font-family: inherit;
        }
        /* Remove margin from last button */
        form:last-child .btn-action { margin-right: 0; }

        .btn-approve {
            color: #28a745;
            border-color: #28a745;
        }
        .btn-approve:hover { background-color: #28a745; color: white; }

        .btn-reject {
            color: #dc3545;
            border-color: #dc3545;
        }
        .btn-reject:hover { background-color: #dc3545; color: white; }

    </style>
</head>
<body>
    <%- include('partials/header') %>
    <div class="container">
        <h1>Pending Approvals</h1>

        <%# Only show this section if the user *can* see it (Admin/Head of HR) %>
        <% if (user.role === 'Admin' || user.role === 'Head of HR') { %>
            <h2>Hourly Rate Changes</h2>
            <% if (rateChanges.length > 0) { %>
                <table>
                    <thead>
                        <tr>
                            <th>Employee ID</th>
                            <th>Employee Name</th>
                            <th>Current Rate</th>
                            <th>Requested Rate</th>
                            <th>Requester ID</th>
                            <th>Requested By</th>
                            <th style="min-width: 150px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% rateChanges.forEach(req => { %>
                            <tr>
                                <td><%= req.public_employee_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.first_name %> <%= req.last_name %></td>
                                <td>$<%= parseFloat(req.hourly_rate).toFixed(2) %></td>
                                <td>$<%= parseFloat(req.pending_hourly_rate).toFixed(2) %></td>
                                <td><%= req.requester_public_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.requester_first_name %> <%= req.requester_last_name %></td>
                                <td>
                                    <form action="/approve/rate/<%= req.public_employee_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-approve">Approve</button>
                                    </form>
                                    <form action="/reject/rate/<%= req.public_employee_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-reject">Reject</button>
                                    </form>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <p class="no-pending">No pending hourly rate changes.</p>
            <% } %>
        <% } %>

        <%# Only show this section if the user *can* see it (Admin/Park Manager) %>
        <% if (user.role === 'Admin' || user.role === 'Park Manager') { %>
            <h2>Maintenance Reassignments</h2>
            <% if (reassignments.length > 0) { %>
                <table>
                    <thead>
                        <tr>
                            <th>Ride ID</th>
                            <th>Ride</th>
                            <th>Currently Assigned</th>
                            <th>Assignee ID</th>
                            <th>Requested Assignee</th>
                            <th>Requester ID</th>
                            <th>Requested By</th>
                            <th style="min-width: 150px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% reassignments.forEach(req => { %>
                            <tr>
                                <td><%= req.public_ride_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.ride_name %></td>
                                <td><%= req.current_employee_name || 'Unassigned' %></td>
                                <td><%= req.assignee_public_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.pending_employee_name %></td>
                                <td><%= req.requester_public_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.requester_name %></td>
                                <td>
                                    <form action="/approve/reassignment/<%= req.public_maintenance_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-approve">Approve</button>
                                    </form>
                                    <form action="/reject/reassignment/<%= req.public_maintenance_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-reject">Reject</button>
                                    </form>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <p class="no-pending">No pending maintenance reassignments.</p>
            <% } %>
        <% } %>

        <%# --- NEW SECTION: Inventory Requests --- %>
        <%# Show if Admin, Park Manager, or Location Manager %>
        <% if (user.role === 'Admin' || user.role === 'Park Manager' || user.role === 'Location Manager') { %>
            <h2>Inventory Restock Requests</h2>
            <% if (inventoryRequests.length > 0) { %>
                <table>
                    <thead>
                        <tr>
                            <th>Vendor ID</th>
                            <th>Vendor</th>
                            <th>Item ID</th>
                            <th>Item</th>
                            <th>Current</th>
                            <th>Requested</th>
                            <th>Requester ID</th>
                            <th>Requested By</th>
                            <th style="min-width: 150px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% inventoryRequests.forEach(req => { %>
                            <tr>
                                <td><%= req.public_vendor_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.vendor_name %></td>
                                <td><%= req.public_item_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.item_name %></td>
                                <td><%= req.current_count %></td>
                                <td><%= req.requested_count %></td>
                                <td><%= req.requester_public_id.substring(0, 8).toUpperCase() %></td>
                                <td><%= req.requester_name %></td>
                                <td>
                                    <form action="/approve/inventory/<%= req.public_request_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-approve">Approve</button>
                                    </form>
                                    <form action="/reject/inventory/<%= req.public_request_id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-action btn-reject">Reject</button>
                                    </form>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <p class="no-pending">No pending inventory restock requests.</p>
            <% } %>
        <% } %>

    </div>
</body>
</html>