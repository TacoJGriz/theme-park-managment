<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Promotion</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f4f4f9; }
        form { max-width: 600px; margin: 2em auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #444; text-align: center; margin-top: 1em; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1em; }
        div { margin-bottom: 10px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
        button { padding: 12px 20px; background-color: #6f42c1; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 1em; }
        .full-width { grid-column: 1 / -1; }
        .error { color: red; font-weight: bold; }
        .cancel-link { display: inline-block; margin-left: 15px; text-decoration: none; color: #6c757d; font-weight: bold; }
        .delete-btn { float: right; background-color: #dc3545; }
        .delete-btn:hover { background-color: #c82333; }
    </style>
</head>
<body>
    <%- include('partials/header') %>
    <h1>Edit Promotion</h1>
    <% if (typeof error !== 'undefined' && error) { %><p class="error"><%= error %></p><% } %>
    <form action="/promotions/edit/<%= promotion.event_id %>" method="POST">
        <input type="hidden" name="returnQuery" value="<%= returnQuery %>">
        
        <div class="form-grid">
            <div class="full-width">
                <label for="event_name">Event Name:</label>
                <input type="text" id="event_name" name="event_name" value="<%= promotion.event_name %>" required>
            </div>
            <div>
                <label for="event_type">Event Type:</label>
                <select id="event_type" name="event_type" required>
                    <% ['Holiday', 'Seasonal', 'Special', 'Weekend'].forEach(type => { %>
                        <option value="<%= type %>" <%= promotion.event_type === type ? 'selected' : '' %>><%= type %></option>
                    <% }); %>
                </select>
            </div>
            <div>
                <label for="discount_percent">Discount (%):</label>
                <input type="number" id="discount_percent" name="discount_percent" step="0.01" min="0" max="100" value="<%= parseFloat(promotion.discount_percent).toFixed(2) %>" required>
            </div>
            <div>
                <label for="start_date">Start Date:</label>
                <input type="date" id="start_date" name="start_date" value="<%= promotion.start_date.toISOString().substring(0, 10) %>" required>
            </div>
            <div>
                <label for="end_date">End Date:</label>
                <input type="date" id="end_date" name="end_date" value="<%= promotion.end_date.toISOString().substring(0, 10) %>" required>
            </div>
            <div class="full-width">
                <label for="summary">Summary:</label>
                <textarea id="summary" name="summary"><%= promotion.summary %></textarea>
            </div>

            <div class="full-width" style="margin-top: 10px; background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #eee;">
                <label style="display: flex; align-items: center; font-weight: bold; cursor: pointer;">
                    <input type="checkbox" name="is_recurring" value="1" style="width: auto; margin-right: 10px; cursor: pointer;" 
                        <%= promotion.is_recurring ? 'checked' : '' %>>
                    Auto-Renew Annually?
                </label>
                <div style="margin-left: 25px; font-size: 0.9em; color: #666;">
                    If checked, the dates will automatically advance by 1 year when this promotion expires.
                </div>
            </div>
        </div>
        <br>
        <button type="submit">Update Promotion</button>
        <a href="/promotions<%= returnQuery ? '?' + returnQuery : '' %>" class="cancel-link">Cancel</a>

        <button type="submit" formaction="/promotions/delete/<%= promotion.event_id %>" class="delete-btn" onclick="return confirm('Are you sure you want to delete this promotion?')">Delete</button>
    </form>
</body>
</html>