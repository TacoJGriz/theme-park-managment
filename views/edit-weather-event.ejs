<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Weather Event</title>
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f4f4f9; }
        form { max-width: 500px; margin: 2em auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #444; text-align: center; margin-top: 0; }
        div { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
        .checkbox-label { display: flex; align-items: center; padding: 10px 0; }
        input[type="checkbox"] { width: auto; margin-right: 10px; }
        button { padding: 12px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 1em; }
        button:hover { background-color: #0056b3; }
        .delete-btn { float: right; background-color: #dc3545; }
        .delete-btn:hover { background-color: #c82333; }
        .cancel-link { display: inline-block; margin-left: 15px; text-decoration: none; color: #6c757d; font-weight: bold; }
    </style>
</head>
<body>
    <%- include('partials/header') %>
    
    <form action="/weather/edit/<%= event.weather_id %>" method="POST">
        <h1>Edit Weather Event</h1>
        <input type="hidden" name="returnQuery" value="<%= returnQuery %>">

        <% 
           // Format dates for datetime-local input (YYYY-MM-DDTHH:MM)
           const toLocalISO = (d) => {
               if (!d) return '';
               const offset = d.getTimezoneOffset() * 60000;
               return new Date(d.getTime() - offset).toISOString().slice(0, 16);
           }
        %>

        <div>
            <label for="event_date">Start Date & Time:</label>
            <input type="datetime-local" id="event_date" name="event_date" value="<%= toLocalISO(new Date(event.event_date)) %>" required>
        </div>
        <div>
            <label for="end_time">End Date & Time (optional):</label>
            <input type="datetime-local" id="end_time" name="end_time" value="<%= event.end_time ? toLocalISO(new Date(event.end_time)) : '' %>">
        </div>
        <div>
            <label for="weather_type">Weather Type:</label>
            <select id="weather_type" name="weather_type" required>
                <% ['Rain', 'Thunderstorm', 'Tornado Warning', 'Heatwave', 'Other'].forEach(type => { %>
                    <option value="<%= type %>" <%= event.weather_type === type ? 'selected' : '' %>><%= type %></option>
                <% }); %>
            </select>
        </div>
        <div>
            <label class="checkbox-label">
                <input type="checkbox" name="park_closure" value="1" <%= event.park_closure ? 'checked' : '' %>>
                Did this cause a park closure?
            </label>
        </div>
        <br>
        <button type="submit">Update Event</button>
        <a href="/weather<%= returnQuery ? '?' + returnQuery : '' %>" class="cancel-link">Cancel</a>

        <button type="submit" formaction="/weather/delete/<%= event.weather_id %>" class="delete-btn" onclick="return confirm('Are you sure you want to delete this log? This cannot be undone.')">Delete</button>
    </form>
</body>
</html>